<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Process stochastic data — stone_stochastic_process • stoner</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Process stochastic data — stone_stochastic_process"><meta property="og:description" content="Convert a modelling group's stochastic files into the summary format,
ready for later uploading to the Montagu data annex. Four files are
produced which reduce age to all-age-total, and under-5-total, by
calendar year, or birth-cohort year."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">stoner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.18</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/stoner.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/vimc/stoner/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Process stochastic data</h1>
    <small class="dont-index">Source: <a href="https://github.com/vimc/stoner/blob/master/R/stochastic_process.R" class="external-link"><code>R/stochastic_process.R</code></a></small>
    <div class="hidden name"><code>stone_stochastic_process.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Convert a modelling group's stochastic files into the summary format,
ready for later uploading to the Montagu data annex. Four files are
produced which reduce age to all-age-total, and under-5-total, by
calendar year, or birth-cohort year.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">stone_stochastic_process</span><span class="op">(</span></span>
<span>  <span class="va">con</span>,</span>
<span>  <span class="va">modelling_group</span>,</span>
<span>  <span class="va">disease</span>,</span>
<span>  <span class="va">touchstone</span>,</span>
<span>  <span class="va">scenarios</span>,</span>
<span>  <span class="va">in_path</span>,</span>
<span>  <span class="va">files</span>,</span>
<span>  <span class="va">cert</span>,</span>
<span>  <span class="va">index_start</span>,</span>
<span>  <span class="va">index_end</span>,</span>
<span>  <span class="va">out_path</span>,</span>
<span>  pre_aggregation_path <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  outcomes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>deaths <span class="op">=</span> <span class="st">"deaths"</span>, cases <span class="op">=</span> <span class="st">"cases"</span>, dalys <span class="op">=</span> <span class="st">"dalys"</span>, yll <span class="op">=</span> <span class="st">"yll"</span><span class="op">)</span>,</span>
<span>  dalys_recipe <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  runid_from_file <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  allow_missing_disease <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  upload_to_annex <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  annex <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  allow_new_database <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  bypass_cert_check <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  testing <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  lines <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  log_file <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-con">con<a class="anchor" aria-label="anchor" href="#arg-con"></a></dt>
<dd><p>DBI connection to production. Used for verifying certificate
against expected properties</p></dd>


<dt id="arg-modelling-group">modelling_group<a class="anchor" aria-label="anchor" href="#arg-modelling-group"></a></dt>
<dd><p>The modelling group id</p></dd>


<dt id="arg-disease">disease<a class="anchor" aria-label="anchor" href="#arg-disease"></a></dt>
<dd><p>The disease</p></dd>


<dt id="arg-touchstone">touchstone<a class="anchor" aria-label="anchor" href="#arg-touchstone"></a></dt>
<dd><p>The touchstone (including version) for these estimates</p></dd>


<dt id="arg-scenarios">scenarios<a class="anchor" aria-label="anchor" href="#arg-scenarios"></a></dt>
<dd><p>A vector of scenario_descriptions. If the files
parameter is of length more than 1, then it must be the same length as
the number of scenarios, and a one-to-one mapping between the two is
assumed.</p></dd>


<dt id="arg-in-path">in_path<a class="anchor" aria-label="anchor" href="#arg-in-path"></a></dt>
<dd><p>The folder containing the stochastic files</p></dd>


<dt id="arg-files">files<a class="anchor" aria-label="anchor" href="#arg-files"></a></dt>
<dd><p>Either a single string containing placeholders to indicate
filenames, or a vector of files, one for each scenario. Placeholders can
include :group :touchstone :scenario :disease and :index</p></dd>


<dt id="arg-cert">cert<a class="anchor" aria-label="anchor" href="#arg-cert"></a></dt>
<dd><p>Name of the certificate file accompanying the estimates</p></dd>


<dt id="arg-index-start">index_start<a class="anchor" aria-label="anchor" href="#arg-index-start"></a></dt>
<dd><p>A scalar or vector matching the length of scenarios.
Each entry is either an integer or NA, indicating the first number in a
sequence of files. NA implies there is a single file with no sequence.
The placeholder :index in the filenames will be replaced with this.</p></dd>


<dt id="arg-index-end">index_end<a class="anchor" aria-label="anchor" href="#arg-index-end"></a></dt>
<dd><p>Similar to index_start, indicating the last number
in a sequence of a files. Can be scalar, applying to all scenarios, or
a vector with an entry for each scenario, with an integer value or NA
in each case.</p></dd>


<dt id="arg-out-path">out_path<a class="anchor" aria-label="anchor" href="#arg-out-path"></a></dt>
<dd><p>Path to writing output files into</p></dd>


<dt id="arg-pre-aggregation-path">pre_aggregation_path<a class="anchor" aria-label="anchor" href="#arg-pre-aggregation-path"></a></dt>
<dd><p>Path to dir to write out pre age-disaggregated
data into. If NULL then this is skipped.</p></dd>


<dt id="arg-outcomes">outcomes<a class="anchor" aria-label="anchor" href="#arg-outcomes"></a></dt>
<dd><p>A list of named vectors, where the name is the burden
outcome, and the elements of the list are the column names in the
stochastic files that should be summed to compute that outcome. The
default is to expect outcomes <code>deaths</code>, <code>cases</code>, <code>dalys</code>, and <code>yll</code>,
with single columns with the same names in the stochastic files.</p></dd>


<dt id="arg-dalys-recipe">dalys_recipe<a class="anchor" aria-label="anchor" href="#arg-dalys-recipe"></a></dt>
<dd><p>If DALYs must be calculated, you can supply a data
frame here, and stoner will calculate DALYs using that recipe. The
data frame must have names <code>outcome</code>, <code>proportion</code>, <code>average_duration</code>
and <code>disability_weight</code>. See <a href="stoner_calculate_dalys.html">stoner_calculate_dalys</a>.</p></dd>


<dt id="arg-runid-from-file">runid_from_file<a class="anchor" aria-label="anchor" href="#arg-runid-from-file"></a></dt>
<dd><p>Occasionally groups have omitted the run_id
from the stochastic file, and provided 200 files, one per run_id. Set
runid_from_file to TRUE if this is the case, to deduce the run_id from
the filenames. The index_start and index_end must be 1 and 200 in
this case.</p></dd>


<dt id="arg-allow-missing-disease">allow_missing_disease<a class="anchor" aria-label="anchor" href="#arg-allow-missing-disease"></a></dt>
<dd><p>Occasionally groups have omitted the
disease column from their stochastic data. Set this to TRUE to expect
that circumstance, and avoid generating warnings.</p></dd>


<dt id="arg-upload-to-annex">upload_to_annex<a class="anchor" aria-label="anchor" href="#arg-upload-to-annex"></a></dt>
<dd><p>Set to TRUE if you want to upload the results
straight into annex. (Files will still be created, as the upload is
relatively fast; creating the csvs is slower and worth caching)</p></dd>


<dt id="arg-annex">annex<a class="anchor" aria-label="anchor" href="#arg-annex"></a></dt>
<dd><p>DBI connection to annex, used if upload_to_annex is TRUE.</p></dd>


<dt id="arg-allow-new-database">allow_new_database<a class="anchor" aria-label="anchor" href="#arg-allow-new-database"></a></dt>
<dd><p>If uploading, then set this to TRUE to enable
creating the stochastic_file table if it is not found.</p></dd>


<dt id="arg-bypass-cert-check">bypass_cert_check<a class="anchor" aria-label="anchor" href="#arg-bypass-cert-check"></a></dt>
<dd><p>If TRUE, then no checks are carried out on the
parameter certificate (if provided).</p></dd>


<dt id="arg-testing">testing<a class="anchor" aria-label="anchor" href="#arg-testing"></a></dt>
<dd><p>For internal use only.</p></dd>


<dt id="arg-lines">lines<a class="anchor" aria-label="anchor" href="#arg-lines"></a></dt>
<dd><p>Number of lines to read from each file, Inf by default to
read all lines. Set a lower number for testing subset of process before
doing the full run.</p></dd>


<dt id="arg-log-file">log_file<a class="anchor" aria-label="anchor" href="#arg-log-file"></a></dt>
<dd><p>Path to file to save logs to, NULL to not log to file.
If file exists it will be appended to, otherwise file will be created.</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>TRUE to silence console logs.</p></dd>

</dl></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Wes Hinsley, Rich Fitzjohn, Robert Ashton.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

